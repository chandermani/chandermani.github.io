---
layout: post
title: Nerddinner on Appharbor
date: '2012-03-03T11:23:00.001+05:30'
author: Chandermani Arora
tags:
- PaaS
- Appharbor
- IronFoundry
- Azure
- Cloud Computing
- Nerddinner
- Cloud
modified_time: '2012-07-22T14:48:14.068+05:30'
thumbnail: http://3.bp.blogspot.com/-mSi96P6Nrbw/T1CIq1Mrn1I/AAAAAAAAAeM/7-O-dCmSho4/s72-c/CreateApplication.png
blogger_id: tag:blogger.com,1999:blog-20117988.post-6222616940636555596
blogger_orig_url: http://chandermani.blogspot.com/2012/03/nerddinner-on-appharbor.html
---

<div dir="ltr" style="text-align: left;" trbidi="on">My <a href="http://chandermani.blogspot.in/2012/02/porting-nerddinner-on-ironfoundry.html" target="_blank">last exercise</a> on deploying <a href="http://nerddinner.codeplex.com/" target="_blank">Nerddinner </a>on <a href="http://ironfoundry.org/" target="_blank">IronFoundry </a>helped me a lot to understand the platforms capabilities. Time to do the same thing on <a href="http://www.appharbor.com/" target="_blank">AppHarbor</a>, another PaaS player in .Net space. AppHarbor tries to emulate <a href="http://www.heroku.com/" target="_blank">Heroku </a>in .Net space. They are the '<i>Azure done right</i> ' brigade. <br /><br />As a developer I just needs to push code either to AppHarbor or some of the supported repositories such as CodePlex, GitHub, BitBucket and AppHarbor does the rest. <span id="goog_771315216"></span>AppHarbor<span id="goog_771315217"></span><br /><ul style="text-align: left;"><li>Builds the code.</li><li>Runs unit tests</li><li>Deploys the application on AppHarbor’s application servers (backed by <a href="http://aws.amazon.com/ec2/" target="_blank">Amazon EC2</a>).</li></ul><div style="text-align: left;"><br /></div><div style="text-align: left;">Other than that it also provides all the standard benefits as provided by most PaaS players.</div><div style="text-align: left;">To gain first hand experience on AppHarbor I decided to port Nerddinner onto AppHarbor. I already had the Nerddinner codebase in github so i could start right away.<br /><br /><b><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Creating Account</span></b>&nbsp;</div><div style="text-align: left;">The first step was to register my account with AppHarbor. Once registration is complete we get a single instance under the free tier. That was good enough for me to complete this exercise.</div><div style="text-align: left;"><br /><b><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Linking to Repository</span></b>&nbsp;</div><div style="text-align: left;">To use the AppHarbor infrastructure I had to link my github project with my AppHarbor account.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">The first step here is to create an application from the AppHarbor dashboard.</div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-mSi96P6Nrbw/T1CIq1Mrn1I/AAAAAAAAAeM/7-O-dCmSho4/s1600/CreateApplication.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="124" src="http://3.bp.blogspot.com/-mSi96P6Nrbw/T1CIq1Mrn1I/AAAAAAAAAeM/7-O-dCmSho4/s640/CreateApplication.png" width="640" /></a></div><div style="text-align: left;"><br /></div><div style="text-align: left;">Then link that application with the code repository (github in my case). I would not detail this process here as details are already available on AppHarbor. Things to note here are</div><ul style="text-align: left;"><li>AppHarbor repository are Git based repositories. Therefore if you plan to use AppHarbor repository you need to setup you git account locally, More details are available <a href="http://support.appharbor.com/kb/getting-started/deploying-your-first-application-using-git" target="_blank">here</a>&nbsp;</li><li>If you are using a third party repository such as CodePlex, GitHub or BitBucket you can look into the respecitve guides to help you integrate with you AppHarbor account.The guides are available at</li><ul><li>BitBucket: <a href="http://support.appharbor.com/kb/api/integrating-with-bitbucket">http://support.appharbor.com/kb/api/integrating-with-bitbucket</a></li><li>Codeplex:&nbsp; <a href="http://support.appharbor.com/kb/api/integrating-with-codeplex">http://support.appharbor.com/kb/api/integrating-with-codeplex</a></li><li>GitHub: <a href="http://blog.appharbor.com/2011/10/13/announcing-github-support">http://blog.appharbor.com/2011/10/13/announcing-github-support</a></li></ul></ul><div style="text-align: left;"></div><div style="text-align: left;">In my case since I was using my public github repository, hence went ahead and configured the link between my github repo and AppHarbor.<br /><br /><b><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Deploying the Application</span></b>&nbsp;</div><div style="text-align: left;">This is where AppHarbor shines.<br /><br />I made some changes to my app on the local clone and pushed the changes to my remote github repository.</div><div style="text-align: left;"><br /></div><div style="text-align: left;">I went back to my dashboard on AppHarbor and I could see the application being built.</div><div style="text-align: left;">It failed for me for the first time due to some missing file but I was able to fix is promptly.</div><blockquote class="tr_bq">AppHarbor makes the build logs available for every build performed. These logs can come in handy while debugging the build failures.</blockquote><div style="text-align: left;">I did a remote push again and the build kicked it again, this time succeeding. I fired the browser and navigated to the application <a href="http://nerddinner-4.apphb.com/">http://nerddinner-4.apphb.com</a> to verify the deployment. Nerddinner was up and running.</div><div style="text-align: left;"><br />Not it was time for database integration.</div><div style="text-align: left;"><br /><b><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Database Deployment</span></b><br />Nerddinner requires SQL Server to store its data and therefore I had to provision a SQL Server instance in AppHarbor.</div><div style="text-align: left;"><br />AppHarbor provides free shared SQL Server instance add-on with 20 MB storage. That was enough for me to get started. I provisioned my SQL Server from AppHarbor addon page&nbsp;<a href="https://appharbor.com/applications/nerddinner-4/addons"></a><br /><br />Once provisioned the next step was to get the details of the new SQL Server instance. These details can be easily retrieved from the application dashboard. More details are available later in the post.<br /><br />Since AppHarbor SQL Server instance is exposed to internet, I was able to connect to it from SQL Management Studio and execute the scripts for Nerddinner and aspnet DB (part of code-base).<br /><br />Database was ready, application was up and running. Now was the time to link these two pieces<br /><br /><b><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Linking Database to Application</span></b>&nbsp;</div><div style="text-align: left;">In AppHarbor this linkage is achieved through Configuration Variables (CV). CV are variable defined for each application in AppHarbor. Once defined the variable names are matched with appsettings key names in configuration file (web.config) and value replacement done during deployment.<br /><br />The following Configuration Variables are created automatically when SQL Server instance is provisioned</div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-a5LOfW06GZU/T1C_wUNSTgI/AAAAAAAAAec/DPiCOxVYMdg/s1600/ConfigurationVariables.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="80" src="http://2.bp.blogspot.com/-a5LOfW06GZU/T1C_wUNSTgI/AAAAAAAAAec/DPiCOxVYMdg/s400/ConfigurationVariables.png" width="400" /></a></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br />Variable <i>SQLSERVER_CONNECTION_STRING_ALIAS</i> is of interest to us. The value of this variable determines which connectionstring (in our config file) would be replaced by the value of variable <i>SQLSERVER_CONNECTION_STRING</i><br /><br />Nerddinner config file has two connection strings '<i>NerdDinners</i>' and '<i>ApplicationServices</i>'. Since I had just one database and just one variable replacement available I had to ignore one of the connection string ('<i>ApplicationServices</i>' in this case). <br /><br />I achieved this using <a href="http://msdn.microsoft.com/en-us/library/dd465326.aspx" target="_blank">Config transformations</a>. Since AppHarbor builds the solution in Release mode (currently no other mode supported) and also supports configuration transformations. I updated web.release.config with the correct transformations.<br /><br />On AppHarbor front I had to set the <i>SQLSERVER_CONNECTION_STRING_ALIAS</i> value to ‘<i>NerdDinners</i>’ to achieve the desired linkage.&nbsp; The above variable is not directly editable from the Configuration Variables interface and requires one to dwell into the SQL Server add-on configuration.&nbsp;</div><div style="text-align: left;"><br /></div><div style="text-align: left;">Here is how this is done<br /><br /><ul style="text-align: left;"><li>Go to the application dashboard and click “SQL Server” add-on link</li></ul></div><div style="text-align: left;"><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-Y1b9bzn0K1U/T1DBWQMsXNI/AAAAAAAAAek/omJDyp5HxDE/s1600/SQL+Server+Addon.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="306" src="http://3.bp.blogspot.com/-Y1b9bzn0K1U/T1DBWQMsXNI/AAAAAAAAAek/omJDyp5HxDE/s640/SQL+Server+Addon.png" width="640" /></a></div><div style="text-align: left;"><br /><ul style="text-align: left;"><li>Click ‘Go to SQL Server’ link on the subsequent page.</li></ul></div><div style="text-align: left;"><br /></div><div style="text-align: left;"></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-fG6cB43diKM/T1DBkPKDcYI/AAAAAAAAAes/A0P6v_IF2ew/s1600/GotoSqlServer.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="77" src="http://2.bp.blogspot.com/-fG6cB43diKM/T1DBkPKDcYI/AAAAAAAAAes/A0P6v_IF2ew/s400/GotoSqlServer.png" width="400" /></a></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /></div><div style="text-align: left;"><br /><br /><br /><br /></div><div style="text-align: left;"><ul style="text-align: left;"><li>This brings up the details for the provisioned SQL Server. Here we can change the alias</li></ul><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-WmdyRdxUyn0/T1Grxn0b1kI/AAAAAAAAAfE/jzRacvSFQ28/s1600/UpdateAlias.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="102" src="http://2.bp.blogspot.com/-WmdyRdxUyn0/T1Grxn0b1kI/AAAAAAAAAfE/jzRacvSFQ28/s400/UpdateAlias.png" width="400" /></a></div><br /><br /><br /><br /><br /><br /><br /><br /></div><div style="text-align: left;">Once I had changed my alias, I pushed my config changes to remote repository and automatic build process kicked in. The site was updated within a matter of seconds and I had a fully functional Nerddinner up and running.<br /><br />The site is available here <a href="http://nerddinner-4.apphb.com/">http://nerddinner-4.apphb.com/</a> The code base is available here <a href="https://github.com/chandermani/NerdDinner70027">https://github.com/chandermani/NerdDinner70027</a><br /><br /><div style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><b>Final Thought</b></div><br />I <a href="http://chandermani.blogspot.in/2012/02/porting-nerddinner-on-ironfoundry.html" target="_blank">recently deployed</a> Nerddinner on IronFoundry, and now on AppHarbor. If you look at developer friendliness, AppHarbor wins hands down. The integration with code repository, easy\fast deployment, add-on services are some of the highlights of AppHarbor. Its deployment model is much superior to Windows Azure and Azure team can take some learning out of AppHarbor experience.<br /><br />AppHarbor provides its infrastructure on per month rather than per hour billing. The same is true for AppHarbor add-ons too.<br /><br /><i><b>Update:</b> As Rune commented&nbsp; 'AppHarbor actually prorates the monthly infrastructure and add-on prices  down to the millisecond, so you only pay for the time you use it (even  more fine-grained than EC2) '</i><br /><br />IronFoundry still is in its nascent stage and a direct comparison would be unfair. Since IronFoundry is open source there is an opportunity to incorporate the good parts of AppHarbor and Windows Azure into IronFoundry platform.</div></div>
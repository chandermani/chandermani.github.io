---
layout: post
title: Porting Nerddinner on IronFoundry
date: '2012-02-25T18:29:00.003+05:30'
author: Chandermani Arora
tags:
- PaaS
- IronFoundry
- Azure
- Cloud Computing
- Nerddinner
- Cloud
modified_time: '2012-03-01T10:31:57.091+05:30'
thumbnail: http://4.bp.blogspot.com/-aEi5LJC90gc/T0Oi_wcVU1I/AAAAAAAAAdU/sKY74uuW9Kc/s72-c/Push.png
blogger_id: tag:blogger.com,1999:blog-20117988.post-8362026385232080090
blogger_orig_url: http://chandermani.blogspot.com/2012/02/porting-nerddinner-on-ironfoundry.html
---

<div dir="ltr" style="text-align: left;" trbidi="on"><div class="separator" style="clear: both; text-align: center;"></div>One of the new entrants in the .Net PaaS space is <a href="http://www.ironfoundry.org/" target="_blank">IronFoundry</a>. <a href="http://tier3.com/" target="_blank">Tier 3</a> an enterprise cloud platform for mid-tier, large enterprise and SaaS have come up with Iron Foundry(IF) a port of <a href="http://cloudfoundry.com/" target="_blank">Cloud Foundry</a>(CF) that is targeted towards Microsoft .Net platform. IF is an implementation of CF that is tightly integrated with the .NET Framework. It can support multiple frameworks, cloud providers, and application services all on a cloud scale platform.<br /><br />The platform is currently thin on documentation so what better way to learn about it than to port some application to run on IF<br /><br /><b><span style="font-size: small;"><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Nerddinner - The application of choice </span></span></b><br /><a href="http://www.nerddinner.com/" target="_blank">Nerddinner</a> was a good fit for this exercise. It is a tiered application with an ASP.Net MVC based front end and MS SQL Server based data access, both supported by Iron Foundry out of box.<br /><br /><b><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">The Process</span></b><br />The process started with setting up an Iron Foundry account that would be used to deploy the application. Since the service is in beta there is no cost incurred during setting up the account. Registration process was trivial but account provisioning was not :) . I tried three email addresses before receiving an account approval mail. <br /><br />The next step was to download the necessary <a href="http://www.ironfoundry.org/download" target="_blank">tools</a> to interact with the IF platform.<br />The following tools come in handy<br /><br /><blockquote class="tr_bq"><b>Cloud Foundry Explorer</b>: A windows app to manage your CF instances and services.<br /><b>VMC .NET</b>: Command Line tool for managing CF instances.<br /><b>Visual Studio Extension</b>: This extension allows directly integration of Visual Studio with the IF platform.</blockquote><br />These tools need to be configured with the account details created earlier. Refer to the <a href="http://help.ironfoundry.org/entries/20794486-cloud-foundry-explorer-documentation-v1-0" target="_blank">documentation </a>for CF Explorer here to understand how to configure user account. Similar <a href="http://help.ironfoundry.org/entries/20815268-visual-studio-extension-documentation-v1-0" target="_blank">configurations</a> are required for Visual Studio extension too.<br /><br /><b><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Migrating Nerddinner codebase</span></b><br />I migrated the Nerddinner (changeset 70027) codebase to github due to my new found interest in git and github. <br />After setting up a new repository, migrating the existing codebase and setting up the clone locally it was time to open the Nerddinner solution in Visual Studio.<br /><br /><b><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">Deploying Nerddinner</span></b><br />The Nerddinner solution compiled successfully. I did a local run to make sure that there were no runtime errors. Nerddinner works well out of box without any manual configuration and same was true in my case. Nerddinner stores data in SQL server and the default codebase is configured to run with local SQL Express.<br /><br />I ignored the database requirement for the time being and just went ahead and deployed the application onto Iron Foundry.<br /><br />Deploying the application from Visual Studio was pretty straight forward.<br />Right click on the ASP.Net MVC project, click ‘Push Cloud Foundry Application..’ (For first time deployment). <br />On the subsequent dialog enter the new application details<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://4.bp.blogspot.com/-aEi5LJC90gc/T0Oi_wcVU1I/AAAAAAAAAdU/sKY74uuW9Kc/s1600/Push.png" imageanchor="1"><img border="0" height="536" src="http://4.bp.blogspot.com/-aEi5LJC90gc/T0Oi_wcVU1I/AAAAAAAAAdU/sKY74uuW9Kc/s640/Push.png" width="640" /></a></div><br />All of the options in this dialog are self-explanatory except the “Application Services” section. I would come back to it later in this post.<br /><br />On clicking Push button, following actions are performed behind the scene<br /><br /><ul><li>The application is pre-compiled. </li><li>The application is pushed to IF infrastructure for deployment.&nbsp;</li><li>The application gets deployed based on the selected configuration and is ready to be used.</li></ul><ul style="text-align: left;"></ul><br />The last step has its own workflow which I would not dwell in this post. Since IF is a port for CF see this <a href="http://www.infoq.com/presentations/Cloud-Foundry-Inside-the-Machine.%20" target="_blank">video </a>to understand the deployment complexities involved.<br /><br />Once deployed I fired the CF Explorer and double clicked the deployment node on the left side<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-Xfju6Z9X16M/T0Ok5BQaiKI/AAAAAAAAAdc/uFpCJLhJDTM/s1600/Explorer.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="340" src="http://2.bp.blogspot.com/-Xfju6Z9X16M/T0Ok5BQaiKI/AAAAAAAAAdc/uFpCJLhJDTM/s640/Explorer.png" width="640" /></a></div><br />The highlighted area shows the instances of my application running (one in this case).<br /><br />I Fired my browser and typed http://nerddinner.gofoundry.net and voila!!! the application was up and running.<br /><br /><blockquote class="tr_bq"><b>Tip: </b><i>When trying to deploy the application from Visual Studio, if pre-compilation fails, you may not be able to determine the exact reason of failure as the failure message gets truncated in the error message window.&nbsp; Use the VMC.Net client tools or aspnet_compiler.exe (part of .net framework) to precompile the application from command line to get detailed error. The aspnet_compiler switches used internally by VMC.Net client are</i>&nbsp;</blockquote><br /><blockquote class="tr_bq">-nologo -v&nbsp; -p&nbsp; -f -u -c </blockquote><br /><div style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><b>Linking Database</b></div>In spite of my initial success, I still needed to tackle database integration.<br />Since file based database and SQL Express are not supported I required some alternative. Iron Foundry Services came to rescue. These services are infrastructure components that can be consume by any host within the IF environment. Currently IF supports two services<br /><br /><ul style="text-align: left;"><li>MongoDB</li><li>MS SQL Database Service</li></ul><br /><blockquote class="tr_bq">As compare to <a href="http://start.cloudfoundry.com/services.html" target="_blank">CF services</a> the service offerings in IF are limited and would evolve over time as the platform matures.</blockquote><br />Meanwhile SQL Database service was available for me to get started. The Services section on the CF explorer allows us to create services for our account.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://3.bp.blogspot.com/-dTSLyN_6uqY/T0hlHKNdd-I/AAAAAAAAAd0/5CKZWmgV0NA/s1600/CreatesService.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="http://3.bp.blogspot.com/-dTSLyN_6uqY/T0hlHKNdd-I/AAAAAAAAAd0/5CKZWmgV0NA/s1600/CreatesService.png" /></a></div><br /><br />Once a service is created it can be used by multiple deployments.<br /><br />I went ahead and created two MS SQL data service.<br /><br /><ul style="text-align: left;"><li>One to store Nerddinner data</li><li>Another to store SQL Profile, Role and Membership data. Nerddinner uses the standard ASP.Net Membership provider API to support authentication \ authorization.</li></ul><br />The next step was to associate the two services with my current deployment. This too can be done from the CF explorer. Drag the service to the right hand side to create an association.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-Zxpjg3CoQW0/T0hk4_X_eBI/AAAAAAAAAds/RIv4SHgHr_8/s1600/Associate+Service.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="340" src="http://2.bp.blogspot.com/-Zxpjg3CoQW0/T0hk4_X_eBI/AAAAAAAAAds/RIv4SHgHr_8/s640/Associate+Service.png" width="640" /></a></div><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-uazh074THh4/T0PPnVCvsxI/AAAAAAAAAdk/eQlJM1AEKW8/s1600/Associate+Service.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><br /></a></div>Although the step above provisioned and associated the database service with my application, I still did not receive any connection information that is needed to connect to the newly provision database. <br />When we associate a service with our application, IF adds the connection information to web.config file of the associated application. To get details about the connection string I had to<br /><br /><ul style="text-align: left;"><li>Download the web.config for my application from CF Explorer.</li><li>Locate connection string with name=”Default” and copy the connection string value </li><li>Replace the existing connection information within the local web.config with the value copied</li></ul><ul style="text-align: left;"></ul><br /><blockquote class="tr_bq"><b>Future Improvement</b>: CF explorer should provide a easier mechanism to download connection details. </blockquote><div style="font-family: &quot;Courier New&quot;,Courier,monospace;"><span style="font-size: small;"><i><br /></i></span></div>After the web.config changes i had to update the deployment. Updating deployment in IF is as easy as deploying a new application in IF. To update an application<br /><br />From Visual Studio select “Update Cloud Foundry Application…”<br />This brings up a dialog which helps us select the application that we want to update.<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://1.bp.blogspot.com/-QrGR7N8D2kY/T0ijxqv_J3I/AAAAAAAAAeE/0aj3K6xEf44/s1600/Update+Application.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="168" src="http://1.bp.blogspot.com/-QrGR7N8D2kY/T0ijxqv_J3I/AAAAAAAAAeE/0aj3K6xEf44/s400/Update+Application.png" width="400" /></a></div><br /><br />After selecting the appropriate ‘Cloud’ and ‘Application Name’ options click update.<br /><br />My deployment was updated and I had linked my application with correct database but still the database had no schema or data.<br /><br /><div style="font-family: &quot;Trebuchet MS&quot;,sans-serif;"><b>Creating DB Schema</b></div>MS SQL database service currently cannot be access from outside and hence tools such as Management Studio would not work. This made the task of creating database schema on the newly provisioned database little challenging.<br /><br />To solve this problem I went ahead and create database schema script using the existing database provided as part of Nerddinner codebase. I created two scripts one for each Nerddinner DB and aspnet DB. The new scripts have been added to the solution and are part of codebase I have shared at the end of this post.<br /><br />A <i>DatabaseCreator</i> class was created containing methods to run both of these scripts. The method calls were added to <i>global.asax.cs</i> Application_Start event to make the scripts run on application first load.<br /><br />I pushed the changed to IF once again and prayed:)<br /><br />Everything ran smoothly and I now had Nerddinner running smoothly, Hurray !!! You can check out the application at <a href="http://nerddinner.gofoundry.net/">http://nerddinner.gofoundry.net</a>. The code base is available at GitHub <a href="https://github.com/chandermani/NerdDinner70027" target="_blank">here</a>. <br /><br />As you can see this was a lengthy exercise but I am glad with the results. Porting Nerddinner help me understand the good, bad and ugly of the new platform. I share some on my observation in the last section of this post<br /><br /><b><span style="font-family: &quot;Trebuchet MS&quot;,sans-serif;">The Verdict</span></b><br /><br /><u>The Goods Parts</u><br /><ul style="text-align: left;"><li>Microsoft Azure has more competition. Competition is always good :) </li><li>Upgrades + configuration changes are fast, really fast as compared to Azure.</li><li>Open Source.</li><li>Visual Studio integration.</li><li>Well suited for web applications.</li></ul><br /><u>Things to Improve</u><br /><ul style="text-align: left;"><li>Lack of error logs. There were time when the instances showed down and did not start at all but there was no way to determine what happened.</li><li>Lack of direct access to database. This makes schema changes difficult.</li><li>Limited documentation.</li><li>Supports only web apps. Concepts similar to Azure worker roles not available</li><li>Limited availability of&nbsp; ‘Services’ as compared to CF.</li><li>Instance customization not available at present. Windows Azure achieves this through startup tasks.</li><li>IF does not have a storage service similar to Azure (table, blobs) or EC2.</li><li>As the framework mature I would love to see a migration guide for migrating solutions from Windows Azure to IF.</li></ul><br /><div style="text-align: justify;">To sum it up Iron Foundry is a promising offering but it is still not ready for prime time consumption. </div><div style="text-align: justify;">The success of Iron Foundry depends upon its adoption within enterprise, its developer community and the Hosting providers (including Tier 3) who can provide hosted solution over Iron Foundry.</div></div>